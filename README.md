
---

# üìå README.md ‚Äî **trikchi_uz**

# trikchi_uz ‚Äî Backend Authentication Service (FastAPI)

`trikchi_uz` ‚Äî —ç—Ç–æ backend-—á–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞/—Å–µ—Ä–≤–∏—Å–∞, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ **FastAPI**.
–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ **JWT Access/Refresh —Ç–æ–∫–µ–Ω–æ–≤**,
—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, –ª–æ–≥–∞—É—Ç –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ access-—Ç–æ–∫–µ–Ω–∞.

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:

* **FastAPI**
* **SQLAlchemy**
* **Passlib (argon2)** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
* **PyJWT** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏
* **SQLite / PostgreSQL** ‚Äî –ø–æ –≤—ã–±–æ—Ä—É
* **Pydantic** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### ‚úî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü—É—Ç—å: `POST /auth/register`

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ email
* –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è —Å –ø–æ–º–æ—â—å—é Argon2
* –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ä–æ–ª—å—é `"customer"`

### ‚úî –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (email + –ø–∞—Ä–æ–ª—å)

–ü—É—Ç—å: `POST /auth/login`

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
* –°–æ–∑–¥–∞–Ω–∏–µ **access token**
* –°–æ–∑–¥–∞–Ω–∏–µ **refresh token**
* Refresh token –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ **HttpOnly Cookie**

### ‚úî Logout

–ü—É—Ç—å: `POST /auth/logout`

* –£–¥–∞–ª—è–µ—Ç refresh token –∏–∑ cookies

### ‚úî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access token (refresh flow)

–ü—É—Ç—å: `POST /auth/refresh_token`

* –ü—Ä–∏–Ω–∏–º–∞–µ—Ç refresh token –∏–∑ Cookies
* –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç –µ–≥–æ
* –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π access token
* –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

# üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–£–∫–∞–∑–∞–Ω—ã –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã, —É—á–∞—Å—Ç–≤—É—é—â–∏–µ –≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```
backend/
‚îÇ
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt_handler.py      # –°–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.py            # –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ registeration_router.py   # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã /auth/...  :contentReference[oaicite:1]{index=1}
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.py            # SQLAlchemy User –º–æ–¥–µ–ª—å
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users_schemas.py    # Pydantic —Å—Ö–µ–º—ã UserRegister, UserLogin, UserResponse
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ database.py             # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ë–î, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å Depends_db
‚îÇ   ‚îî‚îÄ‚îÄ config.py               # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ
‚îî‚îÄ‚îÄ README.md
```

---

# üîê JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è** —Å–∏—Å—Ç–µ–º–∞:

### 1. **Access Token**

* –ñ–∏–≤—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
* –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–Ω–µ –≤ cookie)

### 2. **Refresh Token**

* –ñ–∏–≤—ë—Ç –¥–æ–ª–≥–æ (30 –¥–Ω–µ–π)
* –•—Ä–∞–Ω–∏—Ç—Å—è –≤ **HttpOnly Cookie**
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ access-—Ç–æ–∫–µ–Ω–∞

### –ü–æ—á–µ–º—É —Ç–∞–∫?

* Access –∫–æ—Ä–æ—Ç–∫–∏–π ‚Üí –±–µ–∑–æ–ø–∞—Å–Ω–æ
* Refresh –≤ cookie ‚Üí —É—Å—Ç–æ–π—á–∏–≤–æ –∫ XSS
* –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ª–æ–≥–∏–Ω –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è

---

# üîß –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

## ‚û§ `POST /auth/register`

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

–ü—Ä–∏–º–µ—Ä JSON:

```json
{
  "name": "John",
  "email": "user@example.com",
  "password": "Password123"
}
```

---

## ‚û§ `POST /auth/login`

–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:

```json
{
  "email": "user@example.com",
  "password": "Password123"
}
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

```json
{
  "access_token": "...",
  "token_type": "bearer",
  "user_id": 3
}
```

Refresh-token —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ cookie:

```
Set-Cookie: refresh_token=...; HttpOnly; Path=/; Max-Age=2592000
```

---

## ‚û§ `POST /auth/logout`

–£–¥–∞–ª—è–µ—Ç refresh-token cookie.

---

## ‚û§ `POST /auth/refresh_token`

–ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π access-token –Ω–∞ –æ—Å–Ω–æ–≤–µ refresh —Ç–æ–∫–µ–Ω–∞.

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

```json
{
  "access_token": "...",
  "token_type": "bearer",
  "user_id": 3
}
```

---

# üîë –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

* –ü–∞—Ä–æ–ª–∏ —Ö—ç—à–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ **Argon2**
* `sub` –≤ JWT –≤—Å–µ–≥–¥–∞ —Å—Ç—Ä–æ–∫–∞
* exp —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ **UNIX timestamp**
* Refresh —Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ **HttpOnly cookie —Å path="/"**
* –ù–∏–∫–∞–∫–∏–µ —Ç–æ–∫–µ–Ω—ã –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ localStorage

---

# üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
uvicorn backend.app.main:app --reload
–∏–ª–∏
python run.py 
```

### 3. Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://127.0.0.1:8000/docs
```

---

# üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* Argon2 –¥–ª—è –ø–∞—Ä–æ–ª–µ–π
* Access short-life
* Refresh tokens —á–µ—Ä–µ–∑ HttpOnly Cookie
* JWT —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º HS256
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª–µ–π, email, —Ä–æ–ª—å –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é

---

# üìå –ê–≤—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç: **trikchi_uz**
–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –µ—Å—Ç—å----
